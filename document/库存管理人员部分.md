#### 业务逻辑层模块接口规范

##### 数据层模块职责

| 模块           | 职责                           |
| ------------ | ---------------------------- |
| CommodityBL  | 实现商品管理、商品分类管理所需要的服务          |
| RepositoryBL | 实现库存查询、库存快照所需要的服务            |
| DocBL        | 实现各种单据界面、历史单据查询、部分单据审批所需要的服务 |



##### Commoditybl 模块接口规范

- 提供的服务

  | 名称                            | 条目   | 详情                                       |
  | ----------------------------- | ---- | ---------------------------------------- |
  |                               | 语法   | `public ArrayList<CommodityVO> getCommodityList ()` |
  | Commodity.getCommodityList    | 前置条件 | 无                                        |
  |                               | 后置条件 | 返回所有商品列表                                 |
  |                               | 语法   | `public boolean addCommodity(CommodityVO newCommodity)` |
  | Commodity.addCommodity        | 前置条件 | 输入任意非空名称、非空类型、已经存在的商品分类、大于零的数量以及大于零的成本价格，如果添加成功，返回boolean，否则返回true |
  |                               | 后置条件 | 增加新的商品，更新持久化存储内容                         |
  |                               | 语法   | `public ArrayList<CommodityVO> findCommodityByName(String commodityName)` |
  | Commodity.findCommodityByName | 前置条件 | 输入任意非空商品名称                               |
  |                               | 后置条件 | 根据商品名称查找是否存在相应的商品，若存在匹配的商品则返回相应`ArrayList<CommodityVO>`对象，若不存在匹配项则返回`null` |
  |                               | 语法   | `public CommodityVO findCommodityById(String id)` |
  | Commodity.findCommodityById   | 前置条件 | 输入不违反商品id格式的字符串                          |
  |                               | 后置条件 | 根据商品id查找是否存在相应的商品，如果存在与输入id完全相同的产品，返回一个CommodityVO对象，否则返回null |
  |                               | 语法   | `public boolean deleteCommodity(String id)` |
  | Commodity.deleteCommodity     | 前置条件 | 输入不违反商品id格式的字符串                          |
  |                               | 后置条件 | 如果存在与输入商品id对应的商品，删除商品。如果成功删除商品，返回true，否则返回false |
  |                               | 语法   | `public boolean modifyCommodity(CommodityVO commodity)` |
  | Commodity.modifyCommodity     | 前置条件 | 输入一个非空的CommodityVO对象                     |
  |                               | 后置条件 | 如果成功更新，返回true，否则返回false                  |


- 需要的服务

| 服务名                                      | 服务              |
| ---------------------------------------- | --------------- |
| CommodityDataService.getAll()            | 得到目前存储的所有商品数据对象 |
| CommodityDataService.find(String id)     | 根据ID得到商品数据对象    |
| CommodityDataService.insert(CommodityPO po) | 插入单一持久化对象       |
| CommodityDataService.update(CommodityPO po) | 更新单一持久化对象       |
| CommodityDataService.delete(CommodityPO po) | 删除单一持久化对象       |
| CommodityDataService.findByName(String name) | 根据名称查找多个持久化对象   |



##### Repositorybl 模块接口规范

- 提供的服务

  | 名称                              | 条目   | 详情                                       |
  | ------------------------------- | ---- | ---------------------------------------- |
  |                                 | 语法   | `public ArrayList<RepositoryChangeVO> getRepositoryChanges (long startTime, long endTime)` |
  | Repository.getRepositoryChanges | 前置条件 | 无                                        |
  |                                 | 后置条件 | 返回在startTime和endTime之间（两边均包含）之间所有的库存变化   |
  |                                 | 语法   | `public RepositoryTableVO getRepositoryTable()` |
  | Repository.getRepositoryTable   | 前置条件 | 无                                        |
  |                                 | 后置条件 | 返回GMT-8时区当前日期的库存快照，包括当天的各种商品的名称，型号，库存数量，库存均价，批次，批号，出厂日期。 |


- 需要的服务

| 服务名                                      | 服务          |
| ---------------------------------------- | ----------- |
| RepositoryDataService.get(long start, long end) | 获取时间段内的库存变化 |



##### Documentbl 模块的接口规范

- 提供的服务

  | 名称                               | 条目   | 详情                                       |
  | -------------------------------- | ---- | ---------------------------------------- |
  |                                  | 语法   | `public boolean addAlertDoc (AlertDocVO alertDoc)` |
  | AlertDoc.addAlertDoc             | 前置条件 | 传入一个非空的AlertDocVO对象，其中的数据域alertDocItems的长度必须大于0 |
  |                                  | 后置条件 | 返回是否成功添加库存报警单                            |
  |                                  | 语法   | `public AlertDocVO getAlertDoc (int docId)` |
  | AlertDoc.getAlertDoc             | 前置条件 | 传入一个合法的库存报警单编号                           |
  |                                  | 后置条件 | 返回报警单编号对应的库存报警单对象                        |
  |                                  | 语法   | `public ArrayList<AlertDocVO> getAlertDocs(String userid)` |
  | AlertDoc.getAlertDocs            | 前置条件 | 输入有效的关键字                                 |
  |                                  | 后置条件 | 根据关键字查找是否存在相应的账户，若存在匹配的账户则返回相应`Account`对象，若不存在匹配项则返回`null` |
  |                                  | 语法   | `public void triggered(RepositoryChangeVO change)` |
  | Doc.triggered                    | 前置条件 | 输入非空的一个RepositoryChange对象                |
  |                                  | 后置条件 | 标记所有因为库存变化导致不满足的库存报警单、存入数据库              |
  |                                  | 语法   | `public ArrayList<HistoryDoc> getHistoryDocs(String useid)` |
  | HistroyDoc.getHistoryDocs        | 前置条件 | 输入有效的用户ID                                |
  |                                  | 后置条件 | 返回用户历史单据信息                               |
  |                                  |      |                                          |
  |                                  |      |                                          |
  |                                  |      |                                          |
  |                                  | 语法   | public boolean addLossAndGainDoc (LossAndGainDocPO lossAndGainDoc) |
  | LossAndGainDoc.addLossAndGainDoc | 前置条件 | 传入一个非空的LossAndGainDocPO对象，其中的数据域lossAndGainDocItems的长度必须大于0 |
  |                                  | 后置条件 | 返回是否成功添加库存报损/报溢单                         |
  |                                  |      |                                          |
  |                                  |      |                                          |
  |                                  |      |                                          |

- 需要的服务


| 服务名                                      | 服务            |
| ---------------------------------------- | ------------- |
| DocDataService.insert(DocPO doc)         | 插入Doc         |
| DocDataService.find(String id)           | 根据ID得到Doc对象   |
| DocDataService.update(DocPO doc)         | 更新单一持久化对象     |
| DocDataService.findByTime(long start, long end) | 获取时间段内的全部单据信息 |
| DocDataService.findByUser(String userid) | 获取某一用户的全部单据信息 |



#### 数据层接口规范

##### commoditydataservice 模块的接口规范

- 提供的服务

  | 名称                              | 条目   | 详情                                       |
  | ------------------------------- | ---- | ---------------------------------------- |
  |                                 | 语法   | `public ArrayList<CommodityPO> getAll ()` |
  | CommodityDataService.getAll     | 前置条件 | 无                                        |
  |                                 | 后置条件 | 返回所有商品列表                                 |
  |                                 | 语法   | `public boolean insert(CommodityPO po)`  |
  | CommodityDataService.insert     | 前置条件 | 输入任意非空名称、非空类型、已经存在的商品分类、大于零的数量以及大于零的成本价格，如果添加成功，返回boolean，否则返回true |
  |                                 | 后置条件 | 增加新的商品，更新持久化存储内容                         |
  |                                 | 语法   | `public ArrayList<CommodityPO> findByName(String commodityName)` |
  | CommodityDataService.findByName | 前置条件 | 输入任意非空商品名称                               |
  |                                 | 后置条件 | 根据商品名称查找是否存在相应的商品，若存在匹配的商品则返回相应`ArrayList<CommodityPO>`对象，若不存在匹配项则返回`null` |
  |                                 | 语法   | `public CommodityPO find(String id)`     |
  | Commodity.find                  | 前置条件 | 输入不违反商品id格式的字符串                          |
  |                                 | 后置条件 | 根据商品id查找是否存在相应的商品，如果存在与输入id完全相同的产品，返回一个CommodityPO对象，否则返回null |
  |                                 | 语法   | `public boolean delete(String id)`       |
  | Commodity.delete                | 前置条件 | 输入不违反商品id格式的字符串                          |
  |                                 | 后置条件 | 如果存在与输入商品id对应的商品，删除商品。如果成功删除商品，返回true，否则返回false |
  |                                 | 语法   | `public boolean update(CommodityPO commodity)` |
  | Commodity.update                | 前置条件 | 输入一个非空的CommodityPO对象                     |
  |                                 | 后置条件 | 如果成功更新，返回true，否则返回false                  |



##### repositorydataservice 模块的接口规范

- 提供的服务


| 名称                        | 条目   | 详情                                       |
| ------------------------- | ---- | ---------------------------------------- |
|                           | 语法   | `public ArrayList<RepositoryChangePO> get (long start, long end)` |
| RepositoryDataService.get | 前置条件 | 无                                        |
|                           | 后置条件 | 返回在start和end之间（两边均包含）之间所有的库存变化           |



##### documentdataservice 模块的接口规范

- 提供的服务

| 名称                        | 条目   | 详情                                       |
| ------------------------- | ---- | ---------------------------------------- |
|                           | 语法   | `public boolean insert(DocPO doc)`       |
| DocDataService.insert     | 前置条件 | 输入非空doc对象                                |
|                           | 后置条件 | 如果成功插入，返回true，否则返回false                  |
|                           | 语法   | `public ArrayList<DocPO>findByUser(String userid) ` |
| DocDataService.findByUser | 前置条件 | 如何合法的用户id                                |
|                           | 后置条件 | 返回该用户所有创建过的单据                            |
|                           | 语法   | `public Doc find (String id)`            |
| DocDataService.find       | 前置条件 | 输入合法的单据id                                |
|                           | 后置条件 | 根据单据id查找`Doc`对象并返回，若不存在匹配项则返回`null`      |
|                           | 语法   | `public boolean update(DocPO doc)`       |
| DocDataService.update     | 前置条件 | 输入某个已经存在但是做出修改的Doc对象                     |
|                           | 后置条件 | 如果成功更新doc，返回true，否则返回false               |
|                           | 语法   | `public ArrayList<DocPO>findByTime(long start, long end)` |
| DocDataService.findByTime | 前置条件 | 输入两个long                                 |
|                           | 后置条件 | 返回时间在start和end之间的单据对象                    |

### 信息视角

#### 数据库表

数据库中包含Commodity表、AlertDoc表、AlertDocItem表、CommodityCategory表、HistoryDoc表、LossAndGainDoc表、LossAndGainDocItem表、RepositoryChange表
