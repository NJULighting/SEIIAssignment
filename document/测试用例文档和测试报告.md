# 单元测试报告

[TOC]

## 版本信息

| 修改人  | 时间        | 备注                                       | 版本号  |
| ---- | --------- | ---------------------------------------- | ---- |
| 訾源   | 2018.1.7  | 创建测试用例文档和测试报告                            | 1.0  |
| 訾源   | 2018.1.7  | 添加AccountData，CommodityData，CustomerData模块测试文档和报告 | 1.1  |
| 訾源   | 2018.1.8  | 添加DocData、InitData、LogData、PromotionData、RepositoryData、UserData模块测试文档和报告 | 1.2  |
| 廖均达  | 2018.1.12 | 添加逻辑层的部分                                 | 1.3  |

具体测试代码可查阅项目

要求先执行create_table.sql，data.sql脚本，插入一些必要的数据

## 逻辑层

### AccountBLService

测试用例详见代码

### ApprovalBLService

测试用例详见代码

### CommodityBLService

测试用例详见代码

### CustomerBLService

测试用例详见代码

### DocumentBLService

测试用例详见代码

### InitBLService

测试用例详见代码

### PromotionBLService

测试用例详见代码

### UserBLService

测试用例详见代码

### 测试结果

测试用例全部通过

## 数据层

#### AccountData

##### 测试用例

1. 插入账户 id：16125ada009068，名称：BbidA的校园卡，余额：2333。

   包含交易记录一条，交易时间为当前时间，类型为收入，变化量为300。

2. 插入账户 id：161250068，名称：BbidA的校园卡，余额：2333。

   包含交易记录一条，交易时间为当前时间，类型为收入，变化量为100。

3. 根据id 161250068获取账户，并显示。

4. 获取全部账户。

5. 根据id 161250068删除账户。

6. 插入账户 id：16125ada009068，名称：BbidA的校园卡，余额：2333。

   包含交易记录一条，交易时间为当前时间，类型为收入，变化量为300。

   之后更新该账户余额为6666。

##### 测试结果

| 测试用例 | 结果   | 备注   |
| ---- | ---- | ---- |
| 1    | 通过   |      |
| 2    | 通过   |      |
| 3    | 通过   |      |
| 4    | 通过   |      |
| 5    | 通过   |      |
| 6    | 通过   |      |

#### CommodityData

##### 测试用例

7. 获取全部商品，并显示
8. 获取分类id为4的所有商品，并显示
9. 根据名字中的关键字"W"进行查找，并显示
10. 获取全部分类，并显示
11. 根据商品id"3-1"查找商品，并显示
12. 根据商品名称"坑人的5W的节能灯"查找商品，并显示
13. 添加商品"美国大燃油灯"，id为"4-32"，分类id为4
14. 根据id删除商品"4-32"
15. 增加分类"意大利炮"，父分类id为-1
16. 根据id"5"删除分类
17. 根据id"4"查找分类

##### 测试结果

| 测试用例 | 结果   | 备注      |
| ---- | ---- | ------- |
| 7    | 通过   |         |
| 8    | 通过   |         |
| 9    | 通过   |         |
| 10   | 通过   |         |
| 11   | 通过   |         |
| 12   | 通过   |         |
| 13   | 通过   |         |
| 14   | 通过   | 要求13执行过 |
| 15   | 通过   |         |
| 16   | 通过   | 要求15执行过 |
| 17   | 通过   |         |

#### CustomerData

##### 测试用例

18. 插入3个客户：

| 名字   | 等级   | 种类   |
| ---- | ---- | ---- |
| 孙知良  | 三级   | 进货商  |
| 宋抟   | 一级   | 进货商  |
| 刘钦   | 无极   | 售货商  |

19. 根据id 1 来查找客户并显示
20. 更新客户孙知良的电话为12322222222
21. 更改id 1 的客户应收为200
22. 更改id 3 的客户应付为1000
23. 更改id 2 的客户应收额度为200
24. 获取全部客户信息并显示
25. 删除id 为1、2、3的客户

##### 测试结果

| 测试用例 | 结果   | 备注                  |
| ---- | ---- | ------------------- |
| 18   | 通过   | 要求在本模块测试中第一个执行该测试用例 |
| 19   | 通过   |                     |
| 20   | 通过   |                     |
| 21   | 通过   |                     |
| 22   | 通过   |                     |
| 23   | 通过   |                     |
| 24   | 通过   |                     |
| 25   | 通过   | 要求最后执行该测试用例         |

#### DocData

##### 测试用例

26. 插入一张库存报警单，包含2个小项，分别为编号“1-1”的商品警戒数量5件，编号“4-1”警戒数量5件，创建人id为“161250220”
27. 更新报警单“BJD-20171130-00001”中两个小项的警戒数量为3
28. 根据创建者id 161250220查找单据并显示
29. 分别根据未审批状态、不通过状态查找单据并显示
30. 分别根据报警单类别、现金费用单类别查找单据并显示
31. 根据时间区间（今天到明天）进行查找单据并显示
32. 发送邮件到账号“161250220”中，主题为“我系古天乐”，内容为“我系渣渣辉”

##### 测试结果

| 测试用例 | 结果   | 备注                                |
| ---- | ---- | --------------------------------- |
| 26   | 通过   |                                   |
| 27   | 通过   | 只能在11月30日进行测试                     |
| 28   | 通过   |                                   |
| 29   | 通过   |                                   |
| 30   | 通过   |                                   |
| 31   | 通过   |                                   |
| 32   | 不通过  | 1. Window下python2.7汉字编码问题 2. 路径问题 |

#### InitData

##### 测试用例

33. 进行期初建账，创建者id“161250220”
34. 获取全部期初建账信息，并显示

##### 测试结果

| 测试用例 | 结果   | 备注   |
| ---- | ---- | ---- |
| 33   | 通过   |      |
| 34   | 通过   |      |

#### LogData

##### 测试用例

35. 插入两条log

    | 创建人       | 时间   | 内容                       |
    | --------- | ---- | ------------------------ |
    | 161250220 | 当前时间 | 领导带头膜蛤！                  |
    | 161250220 | 当前时间 | 喂？110嘛？有人侮辱江主席，快控制不住场面了！ |

36. 插入两条log

    | 创建人       | 时间         | 内容                     |
    | --------- | ---------- | ---------------------- |
    | 161250068 | 当日00：00：00 | Naive！                 |
    | 161250068 | 当日00：00：00 | Too Young, Too sample! |

37. 插入两条log

    | 创建人       | 时间         | 内容                     |
    | --------- | ---------- | ---------------------- |
    | 161250068 | 当日00：00：00 | Naive！                 |
    | 161250068 | 当日00：00：00 | Too Young, Too sample! |

38. 插入两条log

    | 创建人       | 时间            | 内容                     |
    | --------- | ------------- | ---------------------- |
    | 161250068 | 17年11月当前日当前时间 | Naive！                 |
    | 161250068 | 17年11月当前日当前时间 | Too Young, Too sample! |

39. 根据时间查找log：开始时间为10月1日，结束时间为当前日9点整

40. 根据id“161250068”查找log，并显示

41. 根据身份：财务人员查找log，并显示

42. 根据开始时间为10月1日，结束时间为当前日9点整和id“161250068”查找log，并显示

43. 根据开始时间为10月1日，结束时间为当前日9点整和身份总经理查找log，并显示

##### 测试结果

要求35、36、37必须在其他测试用例执行之前执行

| 测试用例 | 结果   | 备注         |
| ---- | ---- | ---------- |
| 35   | 通过   |            |
| 36   | 通过   |            |
| 37   | 通过   |            |
| 38   | 通过   | 必须在2017年执行 |
| 39   | 通过   | 必须在2017年执行 |
| 40   | 通过   |            |
| 41   | 通过   |            |
| 42   | 通过   | 必须在2017年执行 |
| 43   | 通过   | 必须在2017年执行 |

#### PromotionData

##### 测试用例

44. 插入2个促销策略

    | 创建者       | 名称        | 类型               | 开始时间      | 结束时间      | 创建时间 | 客户等级要求 | 总价   | 折让   | 代金券   | 代金券失效时间   |
    | --------- | --------- | ---------------- | --------- | --------- | ---- | ------ | ---- | ---- | ----- | --------- |
    | 161250220 | 光棍节大促     | CustomerOriented | 18年10月10日 | 18年12月10日 | 当前时间 | 5      | 1000 | 0.1  | 10000 | 18年12月10日 |
    | 161250220 | 老板带着小姨子跑了 | Combo            | 18年10月10日 | 18年12月10日 | 当前时间 | 5      | 1000 | 0.1  | 10000 | 18年12月10日 |

    期中，第二个促销策略包含组合包：商品1-1，4-1。

45. 获取全部促销策略，并显示

46. 根据id 1获取促销策略

##### 测试结果

44必须先执行

在执行本套测试之前，promotion表必须没有插入过元素

| 测试用例 | 结果   | 备注   |
| ---- | ---- | ---- |
| 44   | 通过   |      |
| 45   | 通过   |      |
| 46   | 通过   |      |

#### RepositoryData

##### 测试用例

47. 获取全部库存变化项，并显示
48. 获取库存快照，并逐个显示小项
49. 增加库存变化项：报损商品1-1，金额10，数量10，时间为当前时间

##### 测试结果

| 测试用例 | 结果       | 备注   |
| ---- | -------- | ---- |
| 47   | 通过（严重卡顿） | 比较卡顿 |
| 48   | 通过       |      |
| 49   | 通过       |      |

#### UserData

##### 测试用例

50. 插入用户：名字为“iznauy”，密码为“iznauy”，id是“161250000”，身份为总经理，无最高权限
51. 根据id获取用户“161250000”
52. 登录账户161250000，输入密码iznauy
53. 登录账号161250000，输入密码ziyuan
54. 更新用户161250000，授予最高权限，其他信息不变
55. 删除用户161250000
56. 获取全部用户并显示
57. 根据id“161250222”登录账户，输入密码为iznauy

##### 测试结果

要求必须顺序执行各项测试用例

| 测试用例 | 结果   | 备注   |
| ---- | ---- | ---- |
| 50   | 通过   |      |
| 51   | 通过   |      |
| 52   | 通过   |      |
| 53   | 通过   |      |
| 54   | 通过   |      |
| 55   | 通过   |      |
| 56   | 通过   |      |
| 57   | 通过   |      |

#### 发现的问题

| 测试用例 | 原因                                     | 是否解决 | 解决措施              |
| ---- | -------------------------------------- | ---- | ----------------- |
| 32   | 1. Window下python2.7汉字编码问题 2. cmd执行路径问题 | 是    | 1.修改路径 2. 使用GBK编码 |
| 47   | 数据库中存在接近20000条变化记录，全部获取需要很久时间          | 是    | 无需解决              |

